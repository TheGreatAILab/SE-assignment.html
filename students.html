<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>智能考勤</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    hr {
        margin: 80px 0;
        width: 100%;
    }
    button {
      font-size: 2rem;
      padding: 1rem 2rem;
    }
    #result {
      font-size: 2rem;
      margin-top: 1rem;
    }
    .dashboard {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
      padding: 20px;
      width: 80%;
    }
    .chart-container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .alert {
      color: red;
      padding: 10px;
      margin: 10px 0;
    }
    .control-panel {
      display: flex;
      gap: 10px;
      padding: 20px;
      flex-wrap: wrap;
    }
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #ffeb3b;
      padding: 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
  </style>
</head>
<body>
<hr>
<button onclick="document.getElementById('result').innerText = students[Math.floor(Math.random() * students.length)]">
    点名
  </button>
  <p id="result"></p>
  <script>
    const students = ["22319091",
"22360300",
"22368031",
"22361058",
"22361063",
"22348229",
"22336113",
"22345020",
"22346095",
"23354177",
"23355032",
"23366094",
"23336284",
"23336272",
"23364037",
"23308060",
"23336299",
"23336320",
"23331029",
"23336336",
"23331059",
"23336194",
"23336232",
"23336247",
"23336249",
"23336250",
"23336251",
"23336252",
"23336253",
"23336254",
"23336255",
"23336259",
"23336260",
"23336261",
"23336262",
"23336265",
"23336267",
"23336266",
"徐上",
"23336269",
"23336270",
"23336271",
"23336274",
"23336275",
"23336276",
"杨立新",
"23336281",
"23336279",
"23336278",
"23336282",
"23336285",
"23336286",
"23336287",
"23336288",
"23336290",
"23336289",
"23336291",
"23336293",
"23331170",
"23336294",
"23336296",
"23336297",
"23336298",
"23336300",
"23336302",
"23336301",
"23336304",
"23336305",
"23336306",
"23336307",
"23336309",
"23336310",
"23336311",
"23336312",
"23336314",
"23336313",
"23336315",
"23336316",
"23336318",
"23336317",
"23336324",
"23336326",
"23336327",
"23336335",
"23336328",
"23336329",
"23336331",
"23336332",
"23336333",
"23336334",
"23336339",
"23336338",
"23336341",
"23336342",
"23336345",
"23336346",
"23336348",
"23336350",
"23336352",
"23336353",
"23336356",
"23336017",
"23336016",
"23336015",
"23336018",
"23336019",
"23336020",
"23336028",
"23336032",
"23336033",
"23336042",
"23336044",
"陈思谋",
"23336063",
"23336076",
"23336084",
"23336080",
"23336089",
"23336119",
"23336135",
"23336132",
"23336145",
"23336165",
"23336170",
"23336178",
"23320048"];
  </script>
  <div class="control-panel">
    <div>
      <select id="status">
        <option value="present">出勤</option>
        <option value="late">迟到</option>
        <option value="early">早退</option>
        <option value="absent">缺勤</option>
      </select>
      <select id="class">
        <option value="软件工程一班">软件工程一班</option>
        <option value="软件工程二班">软件工程二班</option>
        <option value="软件工程三班">软件工程三班</option>
      </select>
      <button onclick="recordAttendance()">记录考勤</button>
    </div>
    <div>
      <select id="reportRange" onchange="updateCharts()">
        <option value="daily">日报</option>
        <option value="weekly">周报</option>
        <option value="monthly">月报</option>
      </select>
      <input type="time" id="reminderTime" value="09:00">
      <button onclick="saveSettings()">保存设置</button>
    </div>
      <div class="control-panel">

  <div>
    <button onclick="clearAllRecords()" style="background-color: #ff4444; color: white;">一键清空记录</button>
  </div>
</div>
  </div>

  <div class="dashboard">
    <div class="chart-container">
      <canvas id="attendanceChart"></canvas>
    </div>
    <div class="chart-container">
      <canvas id="classComparison"></canvas>
    </div>
  </div>

  <div id="alerts"></div>
  <div id="notification" class="notification" style="display: none;"></div>

  <script>
      const classColors = {
        "软件工程一班": "#4CAF50",
        "软件工程二班": "#2196F3",
        "软件工程三班": "#FF9800"
    };

    function clearAllRecords() {
  if (confirm("确定要清空所有考勤记录吗？此操作不可恢复！")) {
    localStorage.removeItem('attendanceData');
    attendanceData = [];

    if (charts.attendanceChart) charts.attendanceChart.destroy();
    if (charts.classComparison) charts.classComparison.destroy();

    updateCharts();

    document.getElementById('alerts').innerHTML = '';

    showNotification('所有记录已清空', 5000);
  }
}
    let charts = {};
    let attendanceData = JSON.parse(localStorage.getItem('attendanceData')) || [];
    let settings = JSON.parse(localStorage.getItem('settings')) || { reminderTime: '09:00' };

    // 保存设置
    function saveSettings() {
      settings.reminderTime = document.getElementById('reminderTime').value;
      localStorage.setItem('settings', JSON.stringify(settings));
      showNotification('设置已保存');
    }

    // 考勤记录
    function recordAttendance() {
      const student = students[Math.floor(Math.random() * students.length)];
      const status = document.getElementById('status').value;
      const className = document.getElementById('class').value;

      const record = {
        student,
        status,
        class: className,
        timestamp: new Date().toISOString()
      };

      attendanceData.push(record);
      localStorage.setItem('attendanceData', JSON.stringify(attendanceData));

      checkAttendancePatterns();
      updateCharts();
      showNotification('考勤记录已保存');
    }

    // 生成报表
    function generateReport() {
      const range = document.getElementById('reportRange').value;
      const now = new Date();
      return attendanceData.filter(record => {
        const recordDate = new Date(record.timestamp);
        switch(range) {
          case 'weekly':
            return recordDate > new Date(now.setDate(now.getDate() - 7));
          case 'monthly':
            return new Date(recordDate).getMonth() === new Date().getMonth();
          default:
            return recordDate.toDateString() === new Date().toDateString();
        }
      });
    }

    // 数据可视化
    function updateCharts() {
      const reportData = generateReport();

      // 销毁旧图表
      if (charts.attendanceChart) charts.attendanceChart.destroy();
      if (charts.classComparison) charts.classComparison.destroy();

      // 考勤分布饼图
      const statusCounts = reportData.reduce((acc, {status}) => {
        acc[status] = (acc[status] || 0) + 1;
        return acc;
      }, {});

      charts.attendanceChart = new Chart(document.getElementById('attendanceChart'), {
        type: 'pie',
        data: {
          labels: Object.keys(statusCounts),
          datasets: [{
            data: Object.values(statusCounts),
            backgroundColor: ['#4CAF50', '#FFC107', '#FF5722', '#F44336']
          }]
        }
      });

      // 班级比较柱状图
      const classes = [...new Set(reportData.map(r => r.class))];
        const datasets = classes.map(className => {
        const classData = reportData.filter(r => r.class === className);
        const total = classData.length;
        return {
            label: className,
            data: [
                (classData.filter(d => d.status === 'present').length / total * 100).toFixed(2),
                (classData.filter(d => d.status === 'late').length / total * 100).toFixed(2),
                (classData.filter(d => d.status === 'early').length / total * 100).toFixed(2)
            ],
            backgroundColor: classColors[className] || "#9E9E9E"  // 使用预设颜色，默认灰色
        };
    });

      charts.classComparison = new Chart(document.getElementById('classComparison'), {
        type: 'bar',
        data: {
          labels: ['出勤率', '迟到率', '早退率'],
          datasets: datasets
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: '百分比 (%)'
              }
            }
          }
        }
      });
    }

    // 点名提醒
    function checkRollCallReminder() {
      const [targetHours, targetMinutes] = settings.reminderTime.split(':');
      const now = new Date();

      if (now.getHours() === parseInt(targetHours) &&
          now.getMinutes() === parseInt(targetMinutes)) {
        showNotification('即将到点名时间，请准备开始考勤！');
      }
    }

    // 显示通知
    function showNotification(message, duration=3000) {
      const el = document.getElementById('notification');
      el.style.display = 'block';
      el.textContent = message;
      setTimeout(() => el.style.display = 'none', duration);
    }

    // 初始化
    document.getElementById('reminderTime').value = settings.reminderTime;
    setInterval(checkRollCallReminder, 60000);
    updateCharts();
  </script>
</body>
</html>
