<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>随机点名</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    button {
      font-size: 1.5rem;
      padding: 0.8rem 1.5rem;
      margin: 0.3rem;
    }
    #result {
      font-size: 2rem;
      margin: 1rem;
    }
    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #remaining {
      margin: 1rem;
      font-size: 1.2rem;
    }
    .status-btns {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="callBtn">点名</button>
    <div class="status-btns">
      <button id="presentBtn" disabled>到</button>
      <button id="absentBtn" disabled>未到</button>
    </div>
    <button id="exportBtn">导出Excel</button>
    <button id="resetBtn" style="display:none;">重新开始</button>
    <div id="remaining"></div>
  </div>
  <div id="result"></div>

  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
  <script>
    const students = ["谢慧豪",
"肖金洋",
"廖嘉辉",
"李锐钊",
"罗斯",
"沈嘉乐",
"李佳音",
"丁烁芝",
"王宥森",
"严浩文",
"赖鼎昭",
"朱潇瑶",
"刘盛邦",
"黄润轩",
"许梓烁",
"杨鑫",
"詹伟翔",
"章豪斌",
"钟晨晖",
"丁奕轩",
"黄梓城",
"彭志泓",
"王阳明",
"吴承徽",
"吴佳霖",
"吴乐超",
"吴睿",
"吴深荣",
"吴玟欣",
"吴晓恒",
"吴修远",
"肖睿",
"肖添",
"谢家和",
"谢润文",
"熊昊翔",
"熊彦钧",
"徐观炼",
"徐上",
"徐子欣",
"许才明",
"许君兰",
"闫麟昊",
"阳文轩",
"杨凯",
"杨立新",
"杨铭昊",
"杨培凯",
"杨希凯",
"杨晓乐",
"杨正宇",
"姚书璟",
"姚宇翔",
"叶崇杰",
"游璐玮",
"于远洋",
"余俊翰",
"余鑫",
"张苇航",
"元朗曦",
"袁舜骐",
"岳峻宇",
"詹佳烨",
"张博然",
"张浩宇",
"张皓昱",
"张景翔",
"张洛瑜",
"张人心",
"张若璇",
"张文坚",
"张文翔",
"张相钊",
"张晔",
"张逸",
"张颖琳",
"张宇然",
"张玉瑶",
"张誉方",
"张越",
"赵施琦",
"郑达维",
"郑浩翔",
"郑皓",
"郑晋凯",
"郑思扬",
"郑晓丰",
"郑鑫宇",
"郑芸熙",
"职雨欣",
"钟泓瑨",
"钟俊喆",
"钟思玥",
"钟旺烜",
"周海铭",
"周宏杰",
"周嘉尉",
"周逸",
"周雨桐",
"周梓枫",
"邹书承",
"吴永聪",
"肖淇",
"徐泓昊",
"薛炜鹏",
"张周骁",
"周子健",
"常淇博",
"陈畅",
"陈大有",
"陈龙",
"陈仁培",
"陈思谋",
"段玉飞",
"古康杰",
"郭延庚",
"何晓文",
"胡泉",
"李延泽",
"23336132",
"林翠敏",
"林昀熠",
"龙宇海",
"卢晓玲",
"吕振宁",
"郭靖宇"];
    let remainingStudents = [...students];
    let lastStudent = "";
    let currentStudent = "";
    let records = students.map(name => ({name, status: "未点名"}));
    
    const callBtn = document.getElementById('callBtn');
    const presentBtn = document.getElementById('presentBtn');
    const absentBtn = document.getElementById('absentBtn');
    const exportBtn = document.getElementById('exportBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resultDisplay = document.getElementById('result');
    const remainingDisplay = document.getElementById('remaining');
    
    updateRemainingCount();
    
    callBtn.addEventListener('click', randomStudent);
    presentBtn.addEventListener('click', () => markAttendance('到'));
    absentBtn.addEventListener('click', () => markAttendance('未到'));
    exportBtn.addEventListener('click', exportExcel);
    resetBtn.addEventListener('click', resetSelection);
    
    function randomStudent() {
      if (remainingStudents.length === 0) {
        resultDisplay.textContent = "已完成点名";
        callBtn.style.display = 'none';
        resetBtn.style.display = 'block';
        return;
      }
      
      let randomIndex = Math.floor(Math.random() * remainingStudents.length);
      currentStudent = remainingStudents[randomIndex];
      resultDisplay.textContent = currentStudent;
      
      presentBtn.disabled = false;
      absentBtn.disabled = false;
    }
    
    function markAttendance(status) {
      const record = records.find(r => r.name === currentStudent);
      if (record) {
        record.status = status;
        remainingStudents = remainingStudents.filter(name => name !== currentStudent);
        updateRemainingCount();
        
        currentStudent = "";
        resultDisplay.textContent = "请点击点名";
        presentBtn.disabled = true;
        absentBtn.disabled = true;
        
        if (remainingStudents.length === 0) {
          resultDisplay.textContent = "已完成点名";
          callBtn.style.display = 'none';
          resetBtn.style.display = 'block';
        }
      }
    }
    
    function exportExcel() {
      // 只筛选出已标记"到"或"未到"的记录
      const filteredRecords = records.filter(record => record.status === "到" || record.status === "未到");
            
      const data = filteredRecords.map(record => [record.name, record.status]);
      data.unshift(["姓名", "状态"]);
      
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "点名记录");
      
      XLSX.writeFile(wb, "点名记录.xlsx");
    }
    
    function resetSelection() {
      remainingStudents = [...students];
      records = students.map(name => ({name, status: "未点名"}));
      currentStudent = "";
      lastStudent = "";
      resultDisplay.textContent = "";
      callBtn.style.display = 'block';
      resetBtn.style.display = 'none';
      presentBtn.disabled = true;
      absentBtn.disabled = true;
      updateRemainingCount();
    }
    
    function updateRemainingCount() {
      remainingDisplay.textContent = `剩余: ${remainingStudents.length}/${students.length}`;
    }
  </script>
</body>
</html>