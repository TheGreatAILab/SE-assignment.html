<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>随机点名</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    button {
      font-size: 1.5rem;
      padding: 0.8rem 1.5rem;
      margin: 0.3rem;
    }
    #result {
      font-size: 2rem;
      margin: 1rem;
    }
    .controls {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #remaining {
      margin: 1rem;
      font-size: 1.2rem;
    }
    .status-btns {
      display: flex;
    }
  </style>
</head>
<body>
  <div class="controls">
    <button id="callBtn">点名</button>
    <div class="status-btns">
      <button id="presentBtn" disabled>到</button>
      <button id="absentBtn" disabled>未到</button>
    </div>
    <button id="exportBtn">导出Excel</button>
    <button id="resetBtn" style="display:none;">重新开始</button>
    <div id="remaining"></div>
  </div>
  <div id="result"></div>

  <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
  <script>
    const students = ["22319091",
"22360300",
"22368031",
"22361058",
"22361063",
"22348229",
"22336113",
"22345020",
"22346095",
"23354177",
"23355032",
"23366094",
"23336284",
"23336272",
"23364037",
"23308060",
"23336299",
"23336320",
"23331029",
"23336336",
"23331059",
"23336194",
"23336232",
"23336247",
"23336249",
"23336250",
"23336251",
"23336252",
"23336253",
"23336254",
"23336255",
"23336259",
"23336260",
"23336261",
"23336262",
"23336265",
"23336267",
"23336266",
"徐上",
"23336269",
"23336270",
"23336271",
"23336274",
"23336275",
"23336276",
"23336277",
"23336281",
"23336279",
"23336278",
"23336282",
"23336285",
"23336286",
"23336287",
"23336288",
"23336290",
"23336289",
"23336291",
"23336293",
"23331170",
"23336294",
"23336296",
"23336297",
"23336298",
"23336300",
"23336302",
"23336301",
"23336304",
"23336305",
"23336306",
"23336307",
"23336309",
"23336310",
"23336311",
"23336312",
"23336314",
"23336313",
"23336315",
"23336316",
"23336318",
"23336317",
"23336324",
"23336326",
"23336327",
"23336335",
"23336328",
"23336329",
"23336331",
"23336332",
"23336333",
"23336334",
"23336339",
"23336338",
"23336341",
"23336342",
"23336345",
"23336346",
"23336348",
"23336350",
"23336352",
"23336353",
"23336356",
"23336017",
"23336016",
"23336015",
"23336018",
"23336019",
"23336020",
"23336028",
"23336032",
"23336033",
"23336042",
"23336044",
"23336045",
"23336063",
"23336076",
"23336084",
"23336080",
"23336089",
"23336119",
"23336135",
"23336132",
"23336145",
"23336165",
"23336170",
"23336178",
"23320048"];
    let remainingStudents = [...students];
    let lastStudent = "";
    let currentStudent = "";
    let records = students.map(name => ({name, status: "未点名"}));
    
    const callBtn = document.getElementById('callBtn');
    const presentBtn = document.getElementById('presentBtn');
    const absentBtn = document.getElementById('absentBtn');
    const exportBtn = document.getElementById('exportBtn');
    const resetBtn = document.getElementById('resetBtn');
    const resultDisplay = document.getElementById('result');
    const remainingDisplay = document.getElementById('remaining');
    
    updateRemainingCount();
    
    callBtn.addEventListener('click', randomStudent);
    presentBtn.addEventListener('click', () => markAttendance('到'));
    absentBtn.addEventListener('click', () => markAttendance('未到'));
    exportBtn.addEventListener('click', exportExcel);
    resetBtn.addEventListener('click', resetSelection);
    
    function randomStudent() {
      if (remainingStudents.length === 0) {
        resultDisplay.textContent = "已完成点名";
        callBtn.style.display = 'none';
        resetBtn.style.display = 'block';
        return;
      }
      
      let randomIndex = Math.floor(Math.random() * remainingStudents.length);
      currentStudent = remainingStudents[randomIndex];
      resultDisplay.textContent = currentStudent;
      
      presentBtn.disabled = false;
      absentBtn.disabled = false;
    }
    
    function markAttendance(status) {
      const record = records.find(r => r.name === currentStudent);
      if (record) {
        record.status = status;
        remainingStudents = remainingStudents.filter(name => name !== currentStudent);
        updateRemainingCount();
        
        currentStudent = "";
        resultDisplay.textContent = "请点击点名";
        presentBtn.disabled = true;
        absentBtn.disabled = true;
        
        if (remainingStudents.length === 0) {
          resultDisplay.textContent = "已完成点名";
          callBtn.style.display = 'none';
          resetBtn.style.display = 'block';
        }
      }
    }
    
    function exportExcel() {
      // 只筛选出已标记"到"或"未到"的记录
      const filteredRecords = records.filter(record => record.status === "到" || record.status === "未到");
            
      const data = filteredRecords.map(record => [record.name, record.status]);
      data.unshift(["姓名", "状态"]);
      
      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "点名记录");
      
      XLSX.writeFile(wb, "点名记录.xlsx");
    }
    
    function resetSelection() {
      remainingStudents = [...students];
      records = students.map(name => ({name, status: "未点名"}));
      currentStudent = "";
      lastStudent = "";
      resultDisplay.textContent = "";
      callBtn.style.display = 'block';
      resetBtn.style.display = 'none';
      presentBtn.disabled = true;
      absentBtn.disabled = true;
      updateRemainingCount();
    }
    
    function updateRemainingCount() {
      remainingDisplay.textContent = `剩余: ${remainingStudents.length}/${students.length}`;
    }
  </script>
</body>
</html>